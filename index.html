<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src="speech.js"></script>
        
        <!-- jQuery  - http://code.jquery.com-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

        <!-- Importing Custom Elements -->
        <link rel="import" href="src/voice-player.html">
        <link rel="import" href="src/voice-recognition.html">

        <style>
            * {
                font-family: 'Helvetica Neue', Arial, sans-serif;
                font-size: 4vh;
                letter-spacing: -.1vh;
            }
            body {
                width: 100%;
                heigt: auto;
            }
             
            #wrapper {
                position:absolute; 
                width: 70%;
                top: 35vh;
                left: 15%; 
                margin: 0 auto;
                text-align: center;
            }
            
            #text {
                text-align: center;
                font-size: 8vh;
                font-weight: bold;
                color: #454545;
            }
            
            .example {
                top: 3vh;
            }
        </style>
    </head>
    
    <body>
    
        <div id="wrapper">
             <div id="content">
                <h2 id="speechToText">…</h2> <!-- Listen and show text from user -->
                 <form id="textToSpeech"> </form> <!-- Get words by JavaScript -->
                        <voice-player id="player-element" text=""></voice-player>
                          
                <!-- SpeechRecognition and Answering -->
                <script type="text/javascript">
                    var spokenText = document.getElementById('textToSpeech')
                    var speech = new Speech({
                        debugging: true,
                        continuous: true,
                        interimResults: true,
                        autoRestart: true
                    })

function hello(){
    var sayHello = ["Hallo Tim schön dass du hier bist. Darf ich Dir einen Vorschlag machen? ", 
                    "Hey Tim. Hast Du Lust etwas zu unternehmen?", 
                    "Hi Tim ich hoffe Dir geht es gut! Wie wäre es mit einem Vorschlag?", 
                    "Servus Tim. Möchtest Du etwas unternehmen?", 
                    "Gude, möchtest Du etwas Neues erleben Tim?"];
    var text = Math.floor(Math.random()* (sayHello.length-1) );
    console.log(text);
    text = sayHello [ text ];

    return text;
}     
                    
function maybeLater(){
    var sayOkBye = ["Schade. Für ein neues Erlebnis bitte mich einfach um einen neuen Vorschlag. Bis bald.", 
                    "Für ein neues Erlebnis bitte mich einfach um einen neuen Vorschlag. Bis später Tim.", 
                    "Schön. Für ein neues Erlebnis bitte mich einfach um einen neuen Vorschlag. Tschüss Tim.", 
                    "Aktiviere mich, wenn es Dir langweilig wird. Für ein neues Erlebnis bitte mich einfach um einen neuen Vorschlag."];
    var text = Math.floor(Math.random()* (sayHello.length-1) );
    console.log(text);
    text = sayOkBye [ text ];

    return text;
} 
                    
function proposal(){
    var giveProposal = ["Könntest Du dir vorstellen mit einem Sportflugzeug zu fliegen und dabei den Sonnenuntergang dabei zu genießen?", 
                    "Bist Du jemals bei Nacht gewandert und hast am Tag geschlafen?", 
                    "Wie wäre es mit einem Wellnessabend? Vielleicht gibt es in der Nähe etwas passendes für Dich.", 
                    "Du könntest auf den nächstgelegenen Hügel oder Berg steigen und die Aussicht genießen."];
    var text = Math.floor(Math.random()* (sayHello.length-1) );
    console.log(text);
    text = giveProposal [ text ];

    return text;
} 
                         
                    
  speech
    .on('start', function () {
        spokenText.innerHTML = 'Aktiviere micht mit: "Hallo Wanda!"'
    })
    .on('end', function () {
        spokenText.innerHTML = 'Irgendetwas stimmt mit mir nicht - Schaue später nochmal vorbei.'
    })
    
    .on('interimResult', function (msg) {
        var spokenText = msg
        speechToText.innerHTML = msg
     })
    
    .on('finalResult', function (msg) {
        var spokenText = msg
        var response;
        speechToText.innerHTML = msg
        
                
         // Gesprochener Text wird als text definiert.
        var array = spokenText.split(" ") // Dieser Split unterteilt Wörter mit Leerzeichen
        console.log(array); // Console zeigt: [0] => 1. Wort von textToSpeech, [1] => 2. Wort von textToSpeech, [2] => 3. Wort von textToSpeech, …
        
        // db-Aufbau:  id, attention, action
        for(var i=0; i<array.length; i++){
            var element = array[i]; // element ist jeweils ein Wort aus textToSpeech
            var ergebnis = $.get('/process.php?anfrage=' + element, function(data){
            ergebnis=data;
            
                // switch für die action aus der Datenbank
                switch(ergebnis) {
                    case ('sayHelloWanda'):
                        response = hello();
                        spokenText.innerHTML = response;
                        var player = document.querySelector('#player-element');
                        player.setAttribute('text', response);
                        player.speak();
                        console.log(response);
                        break;
                    case ('wantProposal'):
                        response = proposal();
                        spokenText.innerHTML = response;
                        var player = document.querySelector('#player-element');
                        player.setAttribute('text', response);
                        player.speak();
                        console.log(response);
                        break;
                    case ('noProposal'):
                        response = maybeLater();
                        spokenText.innerHTML = response;
                        var player = document.querySelector('#player-element');
                        player.setAttribute('text', response);
                        player.speak();
                        console.log(response);
                        break; 
                };      
            });
        }


        
        })
                    
.start();
            
                </script>
            </div>
        </div>
    </body>
</html>