<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src="speech.js"></script>
        
        <!-- jQuery  - http://code.jquery.com-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

        <!-- Importing Custom Elements -->
        <link rel="import" href="src/voice-player.html">
        <link rel="import" href="src/voice-recognition.html">

        <style>
            * {
                font-family: 'Helvetica Neue', Arial, sans-serif;
                font-size: 4vh;
                letter-spacing: -.1vh;
            }
            body {
                width: 100%;
                heigt: auto;
            }
             
            #wrapper {
                position:absolute; 
                width: 70%;
                top: 35vh;
                left: 15%; 
                margin: 0 auto;
                text-align: center;
            }
            
            #text {
                text-align: center;
                font-size: 8vh;
                font-weight: bold;
                color: #454545;
            }
            
            .example {
                top: 3vh;
            }
        </style>
    </head>
    
    <body>
    
        <div id="wrapper">
             <div id="content">
                <h2 id="speechToText">…</h2> <!-- Listen and show text from user -->
                 <form id="textToSpeech"> </form> <!-- Get words by JavaScript -->
                        <voice-player id="player-element" text=""></voice-player>
                          
                <!-- SpeechRecognition and Answering -->
                <script type="text/javascript">
                    var spokenText = document.getElementById('textToSpeech')
                    var speech = new Speech({
                        debugging: true,
                        continuous: true,
                        interimResults: true,
                        autoRestart: true
                    })

function hello(){

    var sayHello = ["Hallo Tim schön dass du hier bist.", "Hey Tim.", "Hi Tim ich hoffe Dir geht es gut!", "Servus Tim.", "Gude was kann ich für Dich tun Tim?"];

    var text = Math.floor(Math.random()* (sayHello.length-1) );
    console.log(text);
    text = sayHello [ text ];

    return text;
}
                         
                    
  speech
    .on('start', function () {
        spokenText.innerHTML = 'Ich bin bereit.'
    })
    .on('end', function () {
        spokenText.innerHTML = 'Ich bin noch nicht bereit'
    })
    
    .on('interimResult', function (msg) {
        var spokenText = msg
        speechToText.innerHTML = msg
     })
    
    .on('finalResult', function (msg) {
        var spokenText = msg
        var response;
        speechToText.innerHTML = msg
        
                
         // Gesprochener Text wird als text definiert.
        var array = spokenText.split(" ") // Dieser Split unterteilt Wörter mit Leerzeichen
        console.log(array); // Console zeigt: [0] => 1. Wort von textToSpeech, [1] => 2. Wort von textToSpeech, [2] => 3. Wort von textToSpeech, …
        
        // db-Aufbau:  id, attention, action
        for(var i=0; i<array.length; i++){
            var element = array[i]; // element ist jeweils ein Wort aus textToSpeech
            var ergebnis = $.get('/process.php?anfrage=' + element, function(data){
            ergebnis=data;
            
        switch(ergebnis) {
            case ('sayHelloWanda'):
                response = hello();
                spokenText.innerHTML = response;
                var player = document.querySelector('#player-element');
                player.setAttribute('text', response);
                player.speak();
                console.log(response);
                break;
        };      
        
        
            });
        }


        
    })
                    
.start();
                             
                    // oldSpeech.on - Function Test
                    /*speech                                            
                        .on('start', function () {
                            speak.innerHTML = 'Bitte sprich mit mir'
                        })
                        .on('end', function () {
                            speak.innerHTML = 'Ich bin noch nicht bereit'
                        })
                        .on('interimResult', function (msg) {
                            var spokenText = msg
                            speechToText.innerHTML = msg
                            if(spokenText.includes(array)){
                                speak.innerHTML = 'Hallo Tim, wie geht es Dir?'
                            } else{
                                speak.innerHTML = 'Ich verstehe Dich nicht.'
                            }
                        })
                        .on('finalResult', function (msg) {
                            var spokenText = msg
                            var response;
                            speechToText.innerHTML = msg
                            if(spokenText.includes(array)){   // <-- HIER SOLL ANSTATT DAS WORT 'Hallo' einzelne Teile des oben ausgeklammerten Arrays rein.
                                response = 'Hallo Tim, wie geht es Dir?'
                            } else{
                                response = 'Ich verstehe Dich nicht.'
                            }
                            speak.innerHTML = response;
                            var player = document.querySelector('#player-element');
                            player.setAttribute('text', response);
                            player.speak();
                        })
                    
                        .start();*/
                    
                </script>
            </div>
        </div>
    </body>
</html>